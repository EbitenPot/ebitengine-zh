<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    
    <meta name="description" content="Ebitengine is an open source game engine for the Go programming language. Ebitengine&#39;s simple API allows you to quickly and easily develop 2D games that can be deployed across multiple platforms.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#db5620">
    <meta property="og:title" content="Breaking change to 1.12: rendering sub-images - Ebitengine">
    <meta property="og:site_name" content="Ebitengine - A dead simple 2D game engine for Go">
    <meta property="og:image" content="https://ebitengine.org/images/share.png">
    <meta property="og:description" content="Ebitengine is an open source game engine for the Go programming language. Ebitengine&#39;s simple API allows you to quickly and easily develop 2D games that can be deployed across multiple platforms.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@hajimehoshi">
    <meta name="twitter:title" content="Breaking change to 1.12: rendering sub-images - Ebitengine">
    <meta name="twitter:description" content="Ebitengine is an open source game engine for the Go programming language. Ebitengine&#39;s simple API allows you to quickly and easily develop 2D games that can be deployed across multiple platforms.">
    <meta name="twitter:image" content="https://ebitengine.org/images/share.png">
    <title>Breaking change to 1.12: rendering sub-images - Ebitengine</title>
    <link rel="canonical" href="https://ebitengine.org/zh/blog/subimage.html">
    <link rel="stylesheet" type="text/css" href="/styles/style.css">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css" integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X" crossorigin="anonymous">
    <script src="/scripts/script.js" defer></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js" integrity="sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz" crossorigin="anonymous"></script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "909e4403b96c402996fca889d074c29f"}'></script>
  </head>
  <body>
    <input type="checkbox" id="sidemenu"><label for="sidemenu" class="sidemenubutton"></label><label for="sidemenu" class="sidemenucover"></label>
    <nav>
      <h1><a href="/zh/">Ebitengine™</a></h1>
      <ul id="language">
        <li><a href="/en/blog/subimage.html">English</a></li>
      
        <li><a href="/ja/blog/subimage.html">日本語</a></li>
      
        <li class="active">中文</li>
      </ul>
      <ul>
        <li><a href="https://ebiten-zh.vercel.app/">中文</a></li>
      </ul>
      <ul>
        
        
      </ul>
      <h2>Blog</h2>
<h3>2022-08</h3>
<ul>
  <li><a href="./v2.4.0.html">v2.4.0 is released</a></li>
</ul>
<h3>2022-06</h3>
<ul>
  <li><a href="./jam2022.html">Ebitengine Game Jam started</a></li>
</ul>
<h3>2022-05</h3>
<ul>
  <li><a href="./ebitengine.html">We renamed Ebiten to Ebitengine</a></li>
</ul>
<h3>2022-04</h3>
<ul>
  <li><a href="./v2.3.0.html">v2.3.0 is released</a></li>
</ul>
<h3>2022-01</h3>
<ul>
  <li><a href="./native_compiling_for_nintendo_switch.html">Compiling a Go program into a native binary for Nintendo Switch™</a></li>
</ul>
<h3>2021-12</h3>
<ul>
  <li><a href="./2021.html">Ebiten in 2021</a></li>
</ul>
<h3>2021-10</h3>
<ul>
  <li><a href="./v2.2.0.html">v2.2.0 is released</a></li>
</ul>
<h3>2021-08</h3>
<ul>
  <li><a href="./steam.html">How to release an Ebiten game for Steam</a></li>
</ul>
<h3>2021-06</h3>
<ul>
  <li><a href="./nintendo_switch.html">Ebiten now supports Nintendo Switch™!</a></li>
</ul>
<h3>2021-05</h3>
<ul>
  <li><a href="./v2.1.0.html">v2.1.0 is released</a></li>
</ul>
<h3>2020-12</h3>
<ul>
  <li><a href="./2020.html">Ebiten in 2020</a></li>
</ul>
<h3>2020-10</h3>
<ul>
  <li><a href="./v2.0.0.html">v2.0.0 is released</a></li>
  <li><a href="./v2_is_coming.html">Ebiten v2 is coming</a></li>
  <li><a href="./v1.12.0.html">v1.12.0 is released</a></li>
</ul>
<h3>2020-07</h3>
<ul>
  <li><a href="./roadmap2020.html">Roadmap in 2020 and later</a></li>
</ul>
<h3>2020-06</h3>
<ul>
  <li><a href="./subimage.html">Breaking change to 1.12: rendering sub-images</a></li>
</ul>
<h3>2020-04</h3>
<ul>
  <li><a href="./v1.11.0.html">v1.11.0 is released</a></li>
</ul>
<h3>2020-03</h3>
<ul>
  <li><a href="./v1.10.5.html">v1.10.5 is released</a></li>
</ul>
<h3>2020-02</h3>
<ul>
  <li><a href="./v1.10.4.html">v1.10.4 is released</a></li>
</ul>
<h3>2020-01</h3>
<ul>
  <li><a href="./v1.10.3.html">v1.10.3 is released</a></li>
</ul>
<h3>2019-12</h3>
<ul>
  <li><a href="./v1.10.2.html">v1.10.2 is released</a></li>
  <li><a href="./resizable.html">New API to make a resizable window</a></li>
  <li><a href="./2019.html">Ebiten in 2019</a></li>
</ul>
<h3>2019-11</h3>
<ul>
  <li><a href="./v1.10.1.html">v1.10.1 is released</a></li>
  <li><a href="./hello.html">Hello!</a></li>
</ul>

    </nav>
    <main>
      <article>
        <h1>Breaking change to 1.12: rendering sub-images</h1>
<p class="meta">Hajime Hoshi<br><span id="meta-created">2020-06-28</span></p>
<p>This artcile includes the information in June 2020. There's a possibility the plan will change.</p>
<h2>TL;DR</h2>
<p>Ebiten is adding a breaking change to 1.12 (the current master branch). Ebiten will no longer check the source-image region when rendering an image, and unexpected pixels might be rendered in some cases. This rendering result's difference might be seen when all the following conditions are satisfied:</p>
<ul>
  <li>A sub-image (an image created by <code>SubImage</code> function) is used</li>
  <li>The image is rendered with scaling or rotating</li>
  <li>The adjacent areas's graphics are not continuous</li>
</ul>
<p>For example, rendering tiles on texture atlas with scaling or rotating might cause a different result from 1.11. The rendering result might include pixels in its adjacent area. On the other hand, for example, rendering 9-patches should not be problematic since the graphics are continuous.</p>
<div class="grid-container">
  <div class="grid-item-2">
    <p>The next image is an example of a sub-image and the graphics that are not continuous on the right side.</p>
    <p>If necessary, you'd need to create a texture atlas with paddings for each area.</p>
  </div>
  <div class="grid-item-2">
    <p class="img"><img src="/images/blog/subimage/subimage.png" width="360"></p>
  </div>
</div>
<h2>Background</h2>
<div class="grid-container">
  <div class="grid-item-2">
    <p>Ebiten has a feature called automatic texture atlases. Even if you create many <code>ebiten.Image</code> objects, Ebiten tries to allocate them onto one texture atlas when possible. This is for an efficient rendering by reducing graphics commands sent to the GPU. Additionally, Ebiten users don't have to care about this. That's great!</p>
  </div>
  <div class="grid-item-2">
    <p class="img"><img src="/images/blog/subimage/textureatlas.png" width="300"></p>
  </div>
</div>
<p>When Ebiten rendered a part of a texture atlas, Ebiten did a hack not to expose the pixels in the adjacent areas. Without the hack, such adjacent pixels can be exposed, especially when the image is rendered with rotating or scaling. This is a general issue of graphics programming. As the hack, Ebiten did two things:</p>
<ul>
  <li>Shift the texels a little bit.</li>
  <li>Check the source region in the shader.</li>
</ul>
<p>Both were problematic in terms of code maintainability, and the second hack was especially problematic. One reason is performance. This hack requires 'if' branches in the shader programs and degrades the performance. Another thing is that this hack made it hard to define custom shaders, we are now introducing at 1.12. In the custom shaders, we wanted the users to take pixels from an image in an easy way, but we would need a special function for this purpose to perform this hack.</p>
<h2>Removing the hacks</h2>
<div class="grid-container">
  <div class="grid-item-2">
    <p>We decided to remove these hacks. Instead, all the images are allocated onto the automatic texture atlas with 1px paddings. Even without the check of the source region, the outside pixels are transparent color and then this never violates the adjacent areas.</p>
  </div>
  <div class="grid-item-2">
    <p class="img"><img src="/images/blog/subimage/textureatlas_with_paddings.png" width="300"></p>
  </div>
  <div class="grid-item-2">
    <p>However, Ebiten can treat sub-images, which are created by <code>(*ebiten.Image).SubImage</code> function. They are parts of existing images. They cannot be allocated with paddings independently. There was an idea to allocate all the sub-images as independent images with paddings, but this was not good for performance and memory. If a user called <code>SubImage</code> onto an image many times with 1px-shifted regions, each sub-image would be allocated.</p>
  </div>
  <div class="grid-item-2">
    <p class="img"><img src="/images/blog/subimage/subimage_textureatlas.png" width="456"></p>
  </div>
</div>
<p>Then, we gave up to support such paddings around sub-images. As a result, rendering a sub-image can cause different results compared to 1.11. The adjacent area's pixels can be rendered, especially when the image is rotated or scaled.</p>
<h2>Example</h2>
<p>This is an example that causes bleeding edges by a scaled and rotated sub-image. You can see an unexpected green pixel on the right side. This rendering is tested on the latest master branch (<a href="https://github.com/hajimehoshi/ebiten/tree/aee5d6d7084732e4d608ec72e9938e04ceddef5c">aee5d6d7</a>). The result depends on the machine's GPU.</p>
<div class="grid-container">
  <div class="grid-item-2">
    <pre data-codesrc="/go/blog/subimage/example.go"></pre>
  </div>
  <div class="grid-item-2">
    <p class="img"><img src="/images/blog/subimage/example.png" width="320"></p>
    <p class="img"><img src="/images/blog/subimage/example_enlarged.png" width="276"></p>
  </div>
</div>
<h2>What you should do</h2>
<p>If you have your own texture atlas, and the parts are rendered with scaling or rotating, and the parts' graphics are not continuous, you need to add paddings for each part.</p>

      </article>
      <footer>
        
        
      </footer>
    </main>
  </body>
</html>
